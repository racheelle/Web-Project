<%- include("../includes/head") %>
<link rel="stylesheet" href="/css/admin.css">

<div class="admin-container">

  <aside class="admin-sidebar">
    <h2>Zahle Admin</h2>
    <a href="/admin">Dashboard</a>
     <a href="/admin/messages" class="active">Messages</a>
    <a href="/admin/places">Manage Places</a>

           <a href="/admin/places/add">Add Place</a>
                <a href="/admin/admins">Manage Admins</a>
    <a href="/" class="back-home">Back to Homepage</a>
    <a href="/logout">Logout</a>
  </aside>

  <main class="admin-main">
    <h1>Contact Messages</h1>

    <table class="admin-table">
  <tr>
    <th>ID</th>
    <th>Name</th>
    <th>Email</th>
    <th>Message</th>
    <th>Date</th>
    <th>Actions</th>
  </tr>

  <% messages.forEach(m => { %>
    <tr class="<%= m.is_read ? '' : 'unread-row' %>">
      <td><%= m.id %></td>
      <td><%= m.fname %> <%= m.lname %></td>
      <td><%= m.email %></td>

      <td>
        <button class="view-btn"
                data-name="<%= m.fname %> <%= m.lname %>"
                data-email="<%= m.email %>"
                data-message="<%= m.message %>"
        >
          View
        </button>
      </td>

      <td><%= m.created_at.toLocaleString() %></td>

      <td class="action-buttons">
        <% if (!m.is_read) { %>
          <form action="/admin/messages/read/<%= m.id %>" method="POST">
            <button class="mark-read">Mark Read</button>
          </form>
        <% } else { %>
          <form action="/admin/messages/unread/<%= m.id %>" method="POST">
            <button class="mark-unread">Mark Unread</button>
          </form>
        <% } %>

        <button class="delete-btn" data-id="<%= m.id %>">Delete</button>
      </td>
    </tr>
  <% }) %>
</table>

  </main>

</div>

<!-- FULL MESSAGE MODAL -->
<div id="messageModal" class="modal">
  <div class="modal-content">
    <h3 id="modalName"></h3>
    <p><strong>Email:</strong> <span id="modalEmail"></span></p>
    <p id="modalMessage"></p>

    <button id="closeMessage" class="btn-secondary">Close</button>
  </div>
</div>

<!-- DELETE CONFIRMATION MODAL -->
<div id="deleteModal" class="modal">
  <div class="modal-content">
    <h3>Delete Message</h3>
    <p>Are you sure you want to delete this message?</p>

    <form id="deleteForm" method="POST">
      <button class="yes">Yes, Delete</button>
    </form>
    <button class="no" id="closeDelete">Cancel</button>
  </div>
</div>

<script src="/js/adminMessages.js"></script>
